--
-- PostgreSQL database dump
--

-- Dumped from database version 13.8
-- Dumped by pg_dump version 13.8

-- Started on 2023-01-13 15:26:56

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 6 (class 2615 OID 24618)
-- Name: test_task; Type: SCHEMA; Schema: -; Owner: postgres
--

CREATE SCHEMA test_task;


ALTER SCHEMA test_task OWNER TO postgres;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 216 (class 1259 OID 24645)
-- Name: account; Type: TABLE; Schema: test_task; Owner: postgres
--

CREATE TABLE test_task.account (
    id bigint NOT NULL,
    user_id bigint NOT NULL,
    balance numeric(9,2) NOT NULL
);


ALTER TABLE test_task.account OWNER TO postgres;

--
-- TOC entry 217 (class 1259 OID 24665)
-- Name: account_id_seq; Type: SEQUENCE; Schema: test_task; Owner: postgres
--

ALTER TABLE test_task.account ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME test_task.account_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 219 (class 1259 OID 24669)
-- Name: email_data; Type: TABLE; Schema: test_task; Owner: postgres
--

CREATE TABLE test_task.email_data (
    id bigint NOT NULL,
    user_id bigint NOT NULL,
    email character varying(200) NOT NULL,
    CONSTRAINT email_data_check CHECK (((email)::text ~ '^([a-z0-9_-]+\.)*[a-z0-9_-]+@[a-z0-9_-]+(\.[a-z0-9_-]+)*\.[a-z]{2,6}$'::text))
);


ALTER TABLE test_task.email_data OWNER TO postgres;

--
-- TOC entry 222 (class 1259 OID 24706)
-- Name: email_data_id_seq; Type: SEQUENCE; Schema: test_task; Owner: postgres
--

ALTER TABLE test_task.email_data ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME test_task.email_data_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 220 (class 1259 OID 24692)
-- Name: phone_data; Type: TABLE; Schema: test_task; Owner: postgres
--

CREATE TABLE test_task.phone_data (
    id bigint NOT NULL,
    user_id bigint NOT NULL,
    phone character varying(13) NOT NULL,
    CONSTRAINT phone_data_check CHECK (((phone)::text ~ '^\d{4,13}$'::text))
);


ALTER TABLE test_task.phone_data OWNER TO postgres;

--
-- TOC entry 221 (class 1259 OID 24704)
-- Name: phone_data_id_seq; Type: SEQUENCE; Schema: test_task; Owner: postgres
--

ALTER TABLE test_task.phone_data ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME test_task.phone_data_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 215 (class 1259 OID 24620)
-- Name: users; Type: TABLE; Schema: test_task; Owner: postgres
--

CREATE TABLE test_task.users (
    id bigint NOT NULL,
    name character varying(500) NOT NULL,
    date_of_birth date NOT NULL,
    password character varying(500) NOT NULL
);


ALTER TABLE test_task.users OWNER TO postgres;

--
-- TOC entry 218 (class 1259 OID 24667)
-- Name: user_id_seq; Type: SEQUENCE; Schema: test_task; Owner: postgres
--

ALTER TABLE test_task.users ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME test_task.user_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 3073 (class 0 OID 24645)
-- Dependencies: 216
-- Data for Name: account; Type: TABLE DATA; Schema: test_task; Owner: postgres
--

COPY test_task.account (id, user_id, balance) FROM stdin;
1	1	3.75
2	2	100.00
3	3	7.25
\.


--
-- TOC entry 3076 (class 0 OID 24669)
-- Dependencies: 219
-- Data for Name: email_data; Type: TABLE DATA; Schema: test_task; Owner: postgres
--

COPY test_task.email_data (id, user_id, email) FROM stdin;
1	1	emu1_1@mail.com
2	1	emu1_2@mail.com
3	2	emu2_1@mail.com
4	2	emu2_2@mail.com
5	3	emu3_1@mail.com
6	3	emu3_2@mail.com
\.


--
-- TOC entry 3077 (class 0 OID 24692)
-- Dependencies: 220
-- Data for Name: phone_data; Type: TABLE DATA; Schema: test_task; Owner: postgres
--

COPY test_task.phone_data (id, user_id, phone) FROM stdin;
4	1	79207865431
6	1	79207865432
7	2	79207865433
8	2	79207865434
9	3	79207865435
10	3	1234567890123
\.


--
-- TOC entry 3072 (class 0 OID 24620)
-- Dependencies: 215
-- Data for Name: users; Type: TABLE DATA; Schema: test_task; Owner: postgres
--

COPY test_task.users (id, name, date_of_birth, password) FROM stdin;
3	name3	2012-12-04	$2a$12$Fcv2M/I5wbKQbTnPyOKd..o6lekxuCE.ZP7O9FIKKxSq2w9dua2ZC
2	name2	2012-12-03	$2a$12$Fcv2M/I5wbKQbTnPyOKd..o6lekxuCE.ZP7O9FIKKxSq2w9dua2ZC
1	name1	2012-12-02	$2a$12$Fcv2M/I5wbKQbTnPyOKd..o6lekxuCE.ZP7O9FIKKxSq2w9dua2ZC
\.


--
-- TOC entry 3085 (class 0 OID 0)
-- Dependencies: 217
-- Name: account_id_seq; Type: SEQUENCE SET; Schema: test_task; Owner: postgres
--

SELECT pg_catalog.setval('test_task.account_id_seq', 11, true);


--
-- TOC entry 3086 (class 0 OID 0)
-- Dependencies: 222
-- Name: email_data_id_seq; Type: SEQUENCE SET; Schema: test_task; Owner: postgres
--

SELECT pg_catalog.setval('test_task.email_data_id_seq', 11, true);


--
-- TOC entry 3087 (class 0 OID 0)
-- Dependencies: 221
-- Name: phone_data_id_seq; Type: SEQUENCE SET; Schema: test_task; Owner: postgres
--

SELECT pg_catalog.setval('test_task.phone_data_id_seq', 10, true);


--
-- TOC entry 3088 (class 0 OID 0)
-- Dependencies: 218
-- Name: user_id_seq; Type: SEQUENCE SET; Schema: test_task; Owner: postgres
--

SELECT pg_catalog.setval('test_task.user_id_seq', 9, true);


--
-- TOC entry 2925 (class 2606 OID 24651)
-- Name: account account_pk; Type: CONSTRAINT; Schema: test_task; Owner: postgres
--

ALTER TABLE ONLY test_task.account
    ADD CONSTRAINT account_pk PRIMARY KEY (id);


--
-- TOC entry 2927 (class 2606 OID 24664)
-- Name: account account_unique; Type: CONSTRAINT; Schema: test_task; Owner: postgres
--

ALTER TABLE ONLY test_task.account
    ADD CONSTRAINT account_unique UNIQUE (user_id);


--
-- TOC entry 2930 (class 2606 OID 24679)
-- Name: email_data email_pk; Type: CONSTRAINT; Schema: test_task; Owner: postgres
--

ALTER TABLE ONLY test_task.email_data
    ADD CONSTRAINT email_pk PRIMARY KEY (id);


--
-- TOC entry 2932 (class 2606 OID 24691)
-- Name: email_data email_unique; Type: CONSTRAINT; Schema: test_task; Owner: postgres
--

ALTER TABLE ONLY test_task.email_data
    ADD CONSTRAINT email_unique UNIQUE (email);


--
-- TOC entry 2919 (class 2606 OID 24764)
-- Name: account min_balance; Type: CHECK CONSTRAINT; Schema: test_task; Owner: postgres
--

ALTER TABLE test_task.account
    ADD CONSTRAINT min_balance CHECK ((balance >= (0)::numeric)) NOT VALID;


--
-- TOC entry 2918 (class 2606 OID 24637)
-- Name: users min_pass_length; Type: CHECK CONSTRAINT; Schema: test_task; Owner: postgres
--

ALTER TABLE test_task.users
    ADD CONSTRAINT min_pass_length CHECK ((length((password)::text) >= 8)) NOT VALID;


--
-- TOC entry 2936 (class 2606 OID 24699)
-- Name: phone_data phone_data_pkey; Type: CONSTRAINT; Schema: test_task; Owner: postgres
--

ALTER TABLE ONLY test_task.phone_data
    ADD CONSTRAINT phone_data_pkey PRIMARY KEY (id);


--
-- TOC entry 2938 (class 2606 OID 24715)
-- Name: phone_data phone_unique; Type: CONSTRAINT; Schema: test_task; Owner: postgres
--

ALTER TABLE ONLY test_task.phone_data
    ADD CONSTRAINT phone_unique UNIQUE (phone);


--
-- TOC entry 2923 (class 2606 OID 24653)
-- Name: users user_pk; Type: CONSTRAINT; Schema: test_task; Owner: postgres
--

ALTER TABLE ONLY test_task.users
    ADD CONSTRAINT user_pk PRIMARY KEY (id);


--
-- TOC entry 2928 (class 1259 OID 24659)
-- Name: fki_account_user_fk; Type: INDEX; Schema: test_task; Owner: postgres
--

CREATE INDEX fki_account_user_fk ON test_task.account USING btree (user_id);


--
-- TOC entry 2933 (class 1259 OID 24689)
-- Name: fki_email_user_fk; Type: INDEX; Schema: test_task; Owner: postgres
--

CREATE INDEX fki_email_user_fk ON test_task.email_data USING btree (user_id);


--
-- TOC entry 2934 (class 1259 OID 24713)
-- Name: fki_phone_user_fk; Type: INDEX; Schema: test_task; Owner: postgres
--

CREATE INDEX fki_phone_user_fk ON test_task.phone_data USING btree (user_id);


--
-- TOC entry 2939 (class 2606 OID 24654)
-- Name: account account_user_fk; Type: FK CONSTRAINT; Schema: test_task; Owner: postgres
--

ALTER TABLE ONLY test_task.account
    ADD CONSTRAINT account_user_fk FOREIGN KEY (user_id) REFERENCES test_task.users(id) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 2940 (class 2606 OID 24684)
-- Name: email_data email_user_fk; Type: FK CONSTRAINT; Schema: test_task; Owner: postgres
--

ALTER TABLE ONLY test_task.email_data
    ADD CONSTRAINT email_user_fk FOREIGN KEY (user_id) REFERENCES test_task.users(id) ON DELETE CASCADE NOT VALID;


--
-- TOC entry 2941 (class 2606 OID 24708)
-- Name: phone_data phone_user_fk; Type: FK CONSTRAINT; Schema: test_task; Owner: postgres
--

ALTER TABLE ONLY test_task.phone_data
    ADD CONSTRAINT phone_user_fk FOREIGN KEY (user_id) REFERENCES test_task.users(id) ON DELETE CASCADE NOT VALID;


-- Completed on 2023-01-13 15:26:57

--
-- PostgreSQL database dump complete
--

